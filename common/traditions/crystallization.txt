tr_crystallization_adopt = {
    possible = {
        custom_tooltip = {
            fail_text = REQUIRES_FINISHED_PROPHECY
            has_country_flag = crystallization_tradition_unlocked
        }
    }
    on_enabled = {
        hidden_effect = {
            species = {
                change_species_characteristics = {
                    add_trait = trait_auto_mod_originium_II
                    add_traits_at_start_of_list = yes
                }
            }
            every_owned_species = {
                limit = {
                    is_subspecies = root
                }
                change_species_characteristics = {
                    add_trait = trait_auto_mod_originium_II
                    add_traits_at_start_of_list = yes
                }
            }
            update_node_portraits_if_gestalt_effect = yes
            luminary_speech_effect = yes
        }
    }
    unlocks_agenda = agenda_crystallization_replication
    custom_tooltip_with_modifiers = tr_crystallization_adopt_tt
    modifier = {
    }

    on_enabled = {
        if = {
            limit = {
                NOT = {
                    has_technology = tech_crystallization
                }
            }
            give_technology = {
                tech = tech_crystallization
                message = no
            }
        }
    }
    custom_tooltip_with_modifiers = tr_ori_ascension_adopt_tt

    tradition_swap = {
        name = tr_crystallization_adopt_clone_army
        inherit_name = yes
        inherit_icon = yes
        trigger = {
            has_country_flag = clone_army_full_potential
        }
        modifier = {
        }
        custom_tooltip = tr_crystallization_adopt_clone_army_tt
        weight = {
            factor = 1
        }
    }
}

tr_crystallization_finish = {
    custom_tooltip_with_modifiers = tr_crystallization_finish_tt
    modifier = {
        ascension_perks_add = 1
    }

    on_enabled = {
        hidden_effect = {
            country_event = { id = ori_timeline.80 }
            if = {
                limit = {
                    is_hive_empire = no
                }
                country_event = {
                    id = ori_ap.175
                }
            }
            else = {
                country_event = {
                    id = ori_ap.190
                }
            }
            luminary_speech_effect = yes
        }
    }

    tradition_swap = {
        name = tr_crystallization_finish_clone_army
        inherit_name = yes
        inherit_icon = yes
        trigger = {
            has_country_flag = clone_army_full_potential
        }
        custom_tooltip_with_modifiers = tr_crystallization_finish_clone_army_tt
        modifier = {
            ascension_perks_add = 1
        }
        on_enabled = {
            hidden_effect = {
                if = {
                    limit = {
                        is_hive_empire = no
                    }
                    country_event = {
                        id = ori_ap.175
                    }
                }
                else = {
                    country_event = {
                        id = ori_ap.190
                    }
                }
            }
        }
        weight = {
            factor = 1
        }
    }
}

tr_crystallization_evolutionary_extrapolation = {
    custom_tooltip_with_modifiers = tr_crystallization_evolutionary_extrapolation_tt
    modifier = {
        category_biology_research_speed_mult = 0.15
        planet_buildings_clone_vats_upkeep_mult = -0.50
    }

    ai_weight = {
        factor = 5000
    }
}

tr_crystallization_somatic_synthesization = {
    custom_tooltip_with_modifiers = tr_crystallization_somatic_synthesization_tt
    modifier = {
        ORIGINOID_species_trait_points_add = 4
        BIOLOGICAL_species_trait_picks_add = 2
        modify_species_cost_mult = -0.50
    }

    tradition_swap = {
        name = tr_crystallization_somatic_synthesization_clone_army
        inherit_name = no
        inherit_icon = yes
        trigger = {
            has_country_flag = clone_army_full_potential
        }
        custom_tooltip_with_modifiers = tr_crystallization_somatic_synthesization_clone_army_tt
        modifier = {
            ORIGINOID_species_trait_points_add = 4
            BIOLOGICAL_species_trait_picks_add = 2
            modify_species_cost_mult = -0.50
        }
        weight = {
            factor = 1
        }
    }

    ai_weight = {
        factor = 5000
    }
}

tr_crystallization_stage_1_swap = {
    possible = {
        has_tradition = tr_crystallization_evolutionary_extrapolation
    }
    inline_script = {
        script = traditions/ori_tr_stage_1_tradition_swaps
    }

    ai_weight = {
        factor = 5000
    }
}

tr_crystallization_stage_2_swap = {
    possible = {
        has_tradition = tr_crystallization_somatic_synthesization
    }
    inline_script = {
        script = traditions/ori_tr_stage_2_tradition_swaps
    }

    ai_weight = {
        factor = 5000
    }
}

tr_crystallization_stage_3_swap = {
    possible = {
        has_tradition = tr_crystallization_evolutionary_extrapolation
        has_tradition = tr_crystallization_somatic_synthesization
    }
    inline_script = {
        script = traditions/ori_tr_stage_3_tradition_swaps
    }

    ai_weight = {
        factor = 5000
    }
}

# Dummy traditions for tooltip generation
tr_crystallization_crystallized_growth = {
    possible = {
        # Called via tr_stage_1_tradition_swaps
        always = no
    }

    # Effects in the inline script for tooltip generation
    inline_script = {
        script = traditions/tr_crystallization_crystallized_growth
    }

    ai_weight = {
        factor = 0
    }
}

tr_crystallization_artificial_population = {
    possible = {
        # Called via tr_stage_2_tradition_swaps
        always = no
    }

    # Effects in the inline script for tooltip generation
    inline_script = {
        script = traditions/tr_crystallization_artificial_population
    }

    ai_weight = {
        factor = 0
    }
}

tr_crystallization_regenerative_crystallization = {
    possible = {
        # Called via tr_stage_3_tradition_swaps
        always = no
    }

    # Effects in the inline script for tooltip generation
    inline_script = {
        script = traditions/tr_crystallization_regenerative_crystallization
    }

    ai_weight = {
        factor = 0
    }
}

tr_crystallization_regenerative_crystallization_clones = {
    possible = {
        # Called via tr_stage_3_tradition_swaps
        always = no
    }

    # Effects in the inline script for tooltip generation
    inline_script = {
        script = traditions/tr_crystallization_regenerative_crystallization_clones
    }

    ai_weight = {
        factor = 0
    }
}
